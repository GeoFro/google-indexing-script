"use strict";Object.defineProperty(exports, "__esModule", {value: true}); function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; } function _optionalChain(ops) { let lastAccessLHS = undefined; let value = ops[0]; let i = 1; while (i < ops.length) { const op = ops[i]; const fn = ops[i + 1]; i += 2; if ((op === 'optionalAccess' || op === 'optionalCall') && value == null) { return undefined; } if (op === 'access' || op === 'optionalAccess') { lastAccessLHS = value; value = fn(value); } else if (op === 'call' || op === 'optionalCall') { value = fn((...args) => value.call(lastAccessLHS, ...args)); lastAccessLHS = undefined; } } return value; }var _chunkULFXM522js = require('./chunk-ULFXM522.js');var _chunkQOJ77Y22js = require('./chunk-QOJ77Y22.js');var _chunkV4Z4TKLKjs = require('./chunk-V4Z4TKLK.js');var _chunkNGA44QRFjs = require('./chunk-NGA44QRF.js');var _chunkNFCCRGSQjs = require('./chunk-NFCCRGSQ.js');var I=_chunkNFCCRGSQjs.a.call(void 0, ()=>{_chunkULFXM522js.b.call(void 0, );f();_chunkQOJ77Y22js.b.call(void 0, );_chunkNGA44QRFjs.b.call(void 0, );_chunkV4Z4TKLKjs.c.call(void 0, )});var _fs = require('fs');var _path = require('path'); var _path2 = _interopRequireDefault(_path);var z,d,ae,O= exports.q =_chunkNFCCRGSQjs.a.call(void 0, ()=>{_chunkULFXM522js.b.call(void 0, );f();_chunkQOJ77Y22js.b.call(void 0, );_chunkNGA44QRFjs.b.call(void 0, );_chunkV4Z4TKLKjs.c.call(void 0, );I();z=1e3*60*60*24*14,d= exports.o ={rpm:{retries:3,waitingTime:6e4}},ae= exports.p =async(s=process.argv[2],t={})=>{if(!s)throw new Error("Please provide a domain or site URL as the first argument.");t.client_email||(t.client_email=process.env.GIS_CLIENT_EMAIL),t.private_key||(t.private_key=process.env.GIS_PRIVATE_KEY),t.path||(t.path=process.env.GIS_PATH),t.urls||(t.urls=process.env.GIS_URLS?process.env.GIS_URLS.split(","):void 0),t.quota||(t.quota={rpmRetry:process.env.GIS_QUOTA_RPM_RETRY==="true"});let r=await _chunkULFXM522js.a.call(void 0, t.client_email,t.private_key,t.path),e=C(s);console.log(`\u{1F50E} Processing site: ${e}`);let i=_path2.default.join(".cache",`${E(e)}.json`);if(!r)throw new Error("Failed to get access token, check your service account credentials.");e=await P(r,e);let a=t.urls||[];if(a.length===0){console.log("\u{1F50E} Fetching sitemaps and pages...");let[o,n]=await _chunkQOJ77Y22js.a.call(void 0, r,e);if(o.length===0)throw new Error("No sitemaps found, add them to Google Search Console and try again.");a=n,console.log(`\u{1F449} Found ${a.length} URLs in ${o.length} sitemap`)}else a=_(e,a),console.log(`\u{1F449} Found ${a.length} URLs in the provided list`);let p=_fs.existsSync.call(void 0, i)?JSON.parse(_fs.readFileSync.call(void 0, i,"utf8")):{},c={"Submitted and indexed":[],"Duplicate without user-selected canonical":[],"Crawled - currently not indexed":[],"Discovered - currently not indexed":[],"Page with redirect":[],"URL is unknown to Google":[],RateLimited:[],Forbidden:[],Error:[]},x=["Discovered - currently not indexed","Crawled - currently not indexed","URL is unknown to Google","Forbidden","Error","RateLimited"],W=(o,n)=>{let y=x.includes(o),q=new Date(n)<new Date(Date.now()-z);return y&&q};await _chunkV4Z4TKLKjs.a.call(void 0, async o=>{let n=p[o];(!n||W(n.status,n.lastCheckedAt))&&(n={status:await b(r,e,o),lastCheckedAt:new Date().toISOString()},p[o]=n),c[n.status]=c[n.status]?[...c[n.status],o]:[o]},a,50,(o,n)=>{console.log(`\u{1F4E6} Batch ${o+1} of ${n} complete`)}),console.log(""),console.log(`\u{1F44D} Done, here's the status of all ${a.length} pages:`),_fs.mkdirSync.call(void 0, ".cache",{recursive:!0}),_fs.writeFileSync.call(void 0, i,JSON.stringify(p,null,2));for(let o of Object.keys(c)){let n=c[o];n.length!==0&&console.log(`\u2022 ${k(o)} ${o}: ${n.length} pages`)}console.log("");let u=Object.entries(c).flatMap(([o,n])=>x.includes(o)?n:[]);u.length===0?console.log("\u2728 There are no pages that can be indexed. Everything is already indexed!"):(console.log(`\u2728 Found ${u.length} pages that can be indexed.`),u.forEach(o=>console.log(`\u2022 ${o}`))),console.log("");for(let o of u){console.log(`\u{1F4C4} Processing url: ${o}`);let n=await w(r,o,{retriesOnRateLimit:t.quota.rpmRetry?d.rpm.retries:0});n===404?(await L(r,o),console.log("\u{1F680} Indexing requested successfully. It may take a few days for Google to process it.")):n<400&&console.log("\u{1F55B} Indexing already requested previously. It may take a few days for Google to process it."),console.log("")}console.log("\u{1F44D} All done!"),console.log("\u{1F496} Brought to you by https://seogets.com - SEO Analytics."),console.log("")}});function C(s){return s.startsWith("http://")||s.startsWith("https://")?s.endsWith("/")?s:`${s}/`:`sc-domain:${s}`}function E(s){return s.replace("http://","http_").replace("https://","https_").replaceAll("/","_")}function U(s){return`sc-domain:${s.replace("http://","").replace("https://","").replace("/","")}`}function A(s){return`http://${s}/`}function F(s){return`https://${s}/`}async function H(s){let t=await _chunkV4Z4TKLKjs.b.call(void 0, "https://www.googleapis.com/webmasters/v3/sites",{headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`}});if(t.status===403)return console.error("\u{1F510} This service account doesn't have access to any sites."),[];let r=await t.json();return r.siteEntry?r.siteEntry.map(e=>e.siteUrl):(console.error("\u274C No sites found, add them to Google Search Console and try again."),[])}async function P(s,t){let r=await H(s),e=[];if(t.startsWith("https://"))e.push(t),e.push(A(t.replace("https://",""))),e.push(U(t));else if(t.startsWith("http://"))e.push(t),e.push(F(t.replace("http://",""))),e.push(U(t));else if(t.startsWith("sc-domain:"))e.push(t),e.push(A(t.replace("sc-domain:",""))),e.push(F(t.replace("sc-domain:","")));else throw new Error("Unknown site URL format.");for(let i of e)if(r.includes(i))return i;throw new Error("This service account doesn't have access to this site.")}function _(s,t){let r=s.startsWith("http://")?"http://":"https://",e=s.replace("https://","").replace("http://","").replace("sc-domain:","");return t.map(a=>(a=a.trim(),a.startsWith("/")?`${r}${e}${a}`:a.startsWith("http://")||a.startsWith("https://")?a:a.startsWith(e)?`${r}${a}`:`${r}${e}/${a}`))}async function b(s,t,r){try{let e=await _chunkV4Z4TKLKjs.b.call(void 0, "https://searchconsole.googleapis.com/v1/urlInspection/index:inspect",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({inspectionUrl:r,siteUrl:t})});return e.status===403?(console.error("\u{1F510} This service account doesn't have access to this site."),console.error(await e.text()),"Forbidden"):e.status>=300?e.status===429?"RateLimited":(console.error("\u274C Failed to get indexing status."),console.error(`Response was: ${e.status}`),console.error(await e.text()),"Error"):(await e.json()).inspectionResult.indexStatusResult.coverageState}catch(e){throw console.error("\u274C Failed to get indexing status."),console.error(`Error was: ${e}`),e}}function k(s){switch(s){case"Submitted and indexed":return"\u2705";case"Duplicate without user-selected canonical":return"\u{1F635}";case"Crawled - currently not indexed":case"Discovered - currently not indexed":return"\u{1F440}";case"Page with redirect":return"\u{1F500}";case"URL is unknown to Google":return"\u2753";case"RateLimited":return"\u{1F6A6}";default:return"\u274C"}}async function w(s,t,r){let e=await _chunkV4Z4TKLKjs.b.call(void 0, `https://indexing.googleapis.com/v3/urlNotifications/metadata?url=${encodeURIComponent(t)}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`}});if(e.status===403&&(console.error("\u{1F510} This service account doesn't have access to this site."),console.error(`Response was: ${e.status}`),console.error(await e.text())),e.status===429)if(_optionalChain([r, 'optionalAccess', _2 => _2.retriesOnRateLimit])&&_optionalChain([r, 'optionalAccess', _3 => _3.retriesOnRateLimit])>0){let i=(d.rpm.retries-r.retriesOnRateLimit+1)*d.rpm.waitingTime;console.log(`\u{1F6A6} Rate limit exceeded for read requests. Retries left: ${r.retriesOnRateLimit}. Waiting for ${i/1e3}sec.`),await new Promise(a=>setTimeout(a,i)),await w(s,t,{retriesOnRateLimit:r.retriesOnRateLimit-1})}else throw new Error("Rate limit exceeded, try again later. Check quota at https://developers.google.com/search/apis/indexing-api/v3/quota-pricing#quota");return e.status>=500&&(console.error("\u274C Failed to get publish metadata."),console.error(`Response was: ${e.status}`),console.error(await e.text())),e.status}async function L(s,t){let r=await _chunkV4Z4TKLKjs.b.call(void 0, "https://indexing.googleapis.com/v3/urlNotifications:publish",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({url:t,type:"URL_UPDATED"})});if(r.status===403&&(console.error("\u{1F510} This service account doesn't have access to this site."),console.error(`Response was: ${r.status}`)),r.status>=300){if(r.status===429)throw new Error("Rate limit exceeded, try again later. Check quota at https://developers.google.com/search/apis/indexing-api/v3/quota-pricing#quota");console.error("\u274C Failed to request indexing."),console.error(`Response was: ${r.status}`),console.error(await r.text())}}var f=_chunkNFCCRGSQjs.a.call(void 0, ()=>{O();_chunkNGA44QRFjs.b.call(void 0, );_chunkV4Z4TKLKjs.c.call(void 0, )});exports.a = C; exports.b = E; exports.c = U; exports.d = A; exports.e = F; exports.f = H; exports.g = P; exports.h = _; exports.i = b; exports.j = k; exports.k = w; exports.l = L; exports.m = f; exports.n = I; exports.o = d; exports.p = ae; exports.q = O;
//# sourceMappingURL=chunk-WZWCAYA4.js.map